// populate_supabase_data.js
// Run this script once to insert the provided real data into Supabase tables.
// Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in .env.
// Assumes tables exist (run `npm run db:push` if not).

import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.SUPABASE_URL;
const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;

if (!supabaseUrl || !supabaseServiceRoleKey) {
  console.error('Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in .env');
  process.exit(1);
}

const supabase = createClient(supabaseUrl, supabaseServiceRoleKey);

// Full properties data from SQL (10 entries)
const propertiesData = [
  {
    id: '3c4dffd3-8f4d-4018-a664-93ed6d245965',
    address: '456 Test Avenue',
    neighborhood: 'Test Neighborhood',
    borough: 'Manhattan',
    property_type: 'Condo',
    beds: 2,
    baths: 2,
    sqft: 1200,
    units: null,
    price: 750000,
    arv: null,
    estimated_profit: null,
    cap_rate: null,
    annual_income: null,
    condition: null,
    access: 'Available with Appointment',
    images: null,
    description: 'Test property for system validation',
    google_sheets_row_id: null,
    partner_id: null,
    source: 'internal',
    status: 'available',
    is_active: true,
    created_at: '2025-09-12T01:50:07.35Z',
    updated_at: '2025-09-12T01:50:07.35Z'
  },
  {
    id: '46bccfbf-34e9-4b31-8c7a-eab843d7a6e0',
    address: '456 Park Avenue South',
    neighborhood: 'Flatiron',
    borough: 'Manhattan',
    property_type: 'Multi-Family',
    beds: 6,
    baths: 5,
    sqft: 3200,
    units: 3,
    price: 1350000,
    arv: 1650000,
    estimated_profit: 180000,
    cap_rate: 7.2,
    annual_income: 98000,
    condition: 'Good',
    access: 'Available with Appointment',
    images: ['https://images.unsplash.com/photo-1558618666-fcd25c85cd64','https://images.unsplash.com/photo-1523217582562-09d0def993a6','https://images.unsplash.com/photo-1554995207-c18c203602cb'],
    description: 'Beautiful pre-war building in the coveted Flatiron district. This three-family property features high ceilings, original details, and modern upgrades. Strong cash flow with upside potential for value-add renovations.',
    google_sheets_row_id: null,
    partner_id: '41e48aa9-c54d-4842-a8bb-d579c2e93ecf',
    source: 'partner',
    status: 'available',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z'
  },
  {
    id: '53ba84ff-ab36-47d3-9a2a-945736c1abbf',
    address: '123 Park Slope Ave',
    neighborhood: 'Park Slope',
    borough: 'Brooklyn',
    property_type: 'Single Family',
    beds: 4,
    baths: 3,
    sqft: 2100,
    units: null,
    price: 875000,
    arv: null,
    estimated_profit: null,
    cap_rate: null,
    annual_income: null,
    condition: null,
    access: 'Available with Appointment',
    images: null,
    description: 'Beautiful brownstone in prime Park Slope location',
    google_sheets_row_id: null,
    partner_id: null,
    source: 'internal',
    status: 'available',
    is_active: true,
    created_at: '2025-09-11T16:46:41.651Z',
    updated_at: '2025-09-11T16:46:41.651Z'
  },
  {
    id: '717e2f26-4125-4bdd-8091-68ad075b2ca4',
    address: '123 Broadway Street',
    neighborhood: 'Financial District',
    borough: 'Manhattan',
    property_type: 'Commercial',
    beds: 4,
    baths: 3.5,
    sqft: 2500,
    units: 2,
    price: 850000,
    arv: 1200000,
    estimated_profit: 200000,
    cap_rate: 8.5,
    annual_income: 72000,
    condition: 'Excellent',
    access: 'Available with Appointment',
    images: ['https://images.unsplash.com/photo-1497366754035-f200968a6e72','https://images.unsplash.com/photo-1560448204-e02f11c3d0e2','https://images.unsplash.com/photo-1600585154340-be6161a56a0c'],
    description: "Prime commercial property in the heart of Manhattan's Financial District. Recently renovated with modern finishes, this property offers excellent investment potential with strong rental demand. Located near multiple subway lines and business hubs.",
    google_sheets_row_id: null,
    partner_id: '41e48aa9-c54d-4842-a8bb-d579c2e93ecf',
    source: 'partner',
    status: 'available',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z'
  },
  {
    id: '8dd36a0c-87d0-4fb3-aa16-376e83bd9974',
    address: '789 Park Slope Street',
    neighborhood: 'Park Slope',
    borough: 'Brooklyn',
    property_type: 'Multi-Family',
    beds: 8,
    baths: 6,
    sqft: 3500,
    units: 4,
    price: 1200000,
    arv: 1450000,
    estimated_profit: 180000,
    cap_rate: 6.8,
    annual_income: 96000,
    condition: 'Excellent',
    access: 'Available with Appointment',
    images: ['https://images.unsplash.com/photo-1600596542815-ffad4c1539a9','https://images.unsplash.com/photo-1600607687939-ce8a6c25118c','https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3'],
    description: 'Premium four-family brownstone in coveted Park Slope location. Fully renovated with luxury finishes, separate entrances, and strong rental demand. Perfect for sophisticated investors seeking trophy assets in Brooklyn\'s most desirable neighborhood.',
    google_sheets_row_id: null,
    partner_id: null,
    source: 'internal',
    status: 'available',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z'
  },
  {
    id: '91b5767e-3880-46f1-aa46-e64e6dc72f9d',
    address: '567 Williamsburg Avenue',
    neighborhood: 'Williamsburg',
    borough: 'Brooklyn',
    property_type: 'Multi-Family',
    beds: 10,
    baths: 8,
    sqft: 4200,
    units: 5,
    price: 1650000,
    arv: 1950000,
    estimated_profit: 220000,
    cap_rate: 7.5,
    annual_income: 132000,
    condition: 'Good',
    access: 'Available with Appointment',
    images: ['https://images.unsplash.com/photo-1493809842364-78817add7ffb','https://images.unsplash.com/photo-1449824913935-59a10b8d2000','https://images.unsplash.com/photo-1605146769289-440113cc3d00'],
    description: 'Large five-family building in trendy Williamsburg. Mix of renovated and value-add units providing immediate income and upside potential. Walking distance to multiple subway lines, restaurants, and nightlife. Perfect for investors seeking scale.',
    google_sheets_row_id: null,
    partner_id: null,
    source: 'internal',
    status: 'available',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z'
  },
  {
    id: 'bb67582d-781f-4edf-9571-62da56e3cfb0',
    address: '321 Long Island City Plaza',
    neighborhood: 'Long Island City',
    borough: 'Queens',
    property_type: 'Condo',
    beds: 2,
    baths: 2,
    sqft: 1200,
    units: 1,
    price: 485000,
    arv: 580000,
    estimated_profit: 75000,
    cap_rate: 9.2,
    annual_income: 42000,
    condition: 'Excellent',
    access: 'Available with Appointment',
    images: ['https://images.unsplash.com/photo-1545324418-cc1a3fa10c00','https://images.unsplash.com/photo-1502672260266-1c1ef2d93688','https://images.unsplash.com/photo-1512917774080-9991f1c4c750'],
    description: "Modern luxury condo in LIC's fastest-growing neighborhood. Floor-to-ceiling windows with Manhattan skyline views, in-unit washer/dryer, and building amenities. Strong rental demand from young professionals working in Manhattan.",
    google_sheets_row_id: null,
    partner_id: null,
    source: 'internal',
    status: 'available',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z'
  },
  {
    id: 'c5e2c9bf-9250-4e62-82f2-d990935a4ad7',
    address: '456 Upper East Side',
    neighborhood: 'Upper East Side',
    borough: 'Manhattan',
    property_type: 'Condo',
    beds: 2,
    baths: 2,
    sqft: 1200,
    units: null,
    price: 650000,
    arv: null,
    estimated_profit: null,
    cap_rate: null,
    annual_income: null,
    condition: null,
    access: 'Available with Appointment',
    images: null,
    description: 'Modern high-rise apartment with city views',
    google_sheets_row_id: null,
    partner_id: null,
    source: 'internal',
    status: 'available',
    is_active: true,
    created_at: '2025-09-11T16:46:41.651Z',
    updated_at: '2025-09-11T16:46:41.651Z'
  },
  {
    id: 'd385b835-6861-4b8f-8b4c-abf1a0be1950',
    address: '890 Harlem Boulevard',
    neighborhood: 'Harlem',
    borough: 'Manhattan',
    property_type: 'Multi-Family',
    beds: 7,
    baths: 5,
    sqft: 2800,
    units: 3,
    price: 950000,
    arv: 1150000,
    estimated_profit: 120000,
    cap_rate: 8.1,
    annual_income: 78000,
    condition: 'Good',
    access: 'Available with Appointment',
    images: ['https://images.unsplash.com/photo-1575517111839-3a3843ee7f5d','https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf','https://images.unsplash.com/photo-1600566752355-35792bedcfea'],
    description: 'Historic brownstone in up-and-coming section of Harlem. Three-family property with strong cash flow and significant upside potential. Recently renovated top unit commands premium rent. Well-positioned for continued neighborhood appreciation.',
    google_sheets_row_id: null,
    partner_id: '96545c63-982d-4ad2-b17f-539a4cfb90dd',
    source: 'partner',
    status: 'available',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z'
  },
  {
    id: 'f5735873-04d1-448f-9a4a-d1a15f9731c4',
    address: '789 Astoria Blvd',
    neighborhood: 'Astoria',
    borough: 'Queens',
    property_type: 'Multi-Family',
    beds: 6,
    baths: 4,
    sqft: 2800,
    units: null,
    price: 720000,
    arv: null,
    estimated_profit: null,
    cap_rate: null,
    annual_income: null,
    condition: null,
    access: 'Available with Appointment',
    images: null,
    description: 'Triple unit building with excellent rental potential',
    google_sheets_row_id: null,
    partner_id: null,
    source: 'internal',
    status: 'available',
    is_active: true,
    created_at: '2025-09-11T16:46:41.651Z',
    updated_at: '2025-09-11T16:46:41.651Z'
  }
];

// Full foreclosure listings data (9 entries)
const foreclosureData = [
  {
    id: '16ca0d06-aa16-46dc-b832-56630c47b37a',
    address: '2468 Ocean Parkway',
    county: 'Kings',
    auction_date: '2025-10-15T10:00:00Z',
    starting_bid: 750000,
    assessed_value: 950000,
    property_type: 'Multi-Family',
    beds: 6,
    baths: 4,
    sqft: 2800,
    year_built: 1925,
    description: 'Beautiful 3-family home in prime Midwood location. Features original hardwood floors, high ceilings, and spacious layouts. Property is in good condition but being sold at auction due to financial hardship.',
    docket_number: '2025-123456',
    plaintiff: 'First National Bank',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z',
    neighborhood: 'Midwood',
    borough: 'Brooklyn',
    defendant: 'John Smith'
  },
  {
    id: '7c7ca5c8-bda7-4199-9630-12471b7efc37',
    address: '8642 Jerome Avenue',
    county: 'Bronx',
    auction_date: '2025-11-05T10:00:00Z',
    starting_bid: 895000,
    assessed_value: 1100000,
    property_type: 'Multi-Family',
    beds: 8,
    baths: 6,
    sqft: 3200,
    year_built: 1930,
    description: 'Classic 4-family building in revitalized Fordham area. Features original architectural details combined with modern updates. Strong rental income and excellent potential for value-add improvements.',
    docket_number: '2025-456789',
    plaintiff: 'Wells Fargo',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z',
    neighborhood: 'Fordham',
    borough: 'Bronx',
    defendant: 'Sarah Williams'
  },
  {
    id: '821ee8a4-5d1a-49fa-8551-f7c3db790de5',
    address: '45-12 Northern Blvd, Flushing, NY',
    county: 'Queens',
    auction_date: '2025-09-19T01:48:25.834Z',
    starting_bid: 450000,
    assessed_value: 580000,
    property_type: 'Single Family',
    beds: 3,
    baths: 2,
    sqft: 1850,
    year_built: null,
    description: 'Well-maintained single family home in prime Flushing location',
    docket_number: 'QFC-2024-001234',
    plaintiff: 'Bank of America, N.A.',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-12T01:48:25.834Z',
    updated_at: '2025-09-12T01:48:25.834Z',
    neighborhood: null,
    borough: null,
    defendant: null
  },
  {
    id: '98f77879-e27a-46a2-a883-caaecc5ec8d3',
    address: '789 Foreclosure Street, Queens, NY',
    county: 'Queens',
    auction_date: '2025-10-12T01:50:07.805Z',
    starting_bid: 300000,
    assessed_value: 450000,
    property_type: 'Single Family',
    beds: 3,
    baths: 2,
    sqft: 1500,
    year_built: null,
    description: 'Test foreclosure listing',
    docket_number: 'TEST-2024-001',
    plaintiff: 'Test Bank',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-12T01:50:07.806Z',
    updated_at: '2025-09-12T01:50:07.806Z',
    neighborhood: null,
    borough: null,
    defendant: null
  },
  {
    id: '9e42d762-b626-4f27-9f82-45927fcbe162',
    address: '123 Ocean Parkway, Brooklyn, NY',
    county: 'Brooklyn',
    auction_date: '2025-09-22T01:48:25.834Z',
    starting_bid: 680000,
    assessed_value: 850000,
    property_type: 'Multi-Family',
    beds: 6,
    baths: 4,
    sqft: 2800,
    year_built: null,
    description: 'Classic Brooklyn brownstone with rental income potential',
    docket_number: 'BFC-2024-005678',
    plaintiff: 'Wells Fargo Bank, N.A.',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-12T01:48:25.834Z',
    updated_at: '2025-09-12T01:48:25.834Z',
    neighborhood: null,
    borough: null,
    defendant: null
  },
  {
    id: 'b82bdd07-a3fd-413a-bd61-3f618050e1cb',
    address: '6420 Park Place',
    county: 'Kings',
    auction_date: '2025-11-19T10:00:00Z',
    starting_bid: 925000,
    assessed_value: 1050000,
    property_type: 'Multi-Family',
    beds: 5,
    baths: 3,
    sqft: 2200,
    year_built: 1910,
    description: 'Historic 2-family building in the heart of Crown Heights. Features original stained glass, high ceilings, and decorative moldings. Both units recently renovated with modern kitchens and bathrooms.',
    docket_number: '2025-678901',
    plaintiff: 'TD Bank',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z',
    neighborhood: 'Crown Heights',
    borough: 'Brooklyn',
    defendant: 'Jennifer Davis'
  },
  {
    id: 'c3dba2e2-cd5f-4861-911e-11cb018d0e27',
    address: '7531 First Avenue',
    county: 'Queens',
    auction_date: '2025-11-12T11:30:00Z',
    starting_bid: 675000,
    assessed_value: 820000,
    property_type: 'Single Family',
    beds: 3,
    baths: 2,
    sqft: 1400,
    year_built: 1945,
    description: 'Cozy single family home in tree-lined neighborhood of Astoria. Features updated kitchen, finished basement, and a beautiful garden. Close to Ditmars Boulevard business district and transportation.',
    docket_number: '2025-567890',
    plaintiff: 'Citibank',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z',
    neighborhood: 'Astoria',
    borough: 'Queens',
    defendant: 'Michael Brown'
  },
  {
    id: 'd4369421-68d9-4202-a727-8080db902aa6',
    address: '1357 Queens Boulevard',
    county: 'Queens',
    auction_date: '2025-10-22T11:00:00Z',
    starting_bid: 585000,
    assessed_value: 720000,
    property_type: 'Single Family',
    beds: 4,
    baths: 2.5,
    sqft: 1800,
    year_built: 1955,
    description: 'Charming single family home in desirable Elmhurst neighborhood. Features updated kitchen, renovated bathrooms, and a large backyard. Close to transportation and excellent schools.',
    docket_number: '2025-234567',
    plaintiff: 'Bank of New York',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z',
    neighborhood: 'Elmhurst',
    borough: 'Queens',
    defendant: 'Maria Garcia'
  },
  {
    id: 'de4a4723-2d0c-4f3b-9498-0ae9ad7dec96',
    address: '9753 Bedford Avenue',
    county: 'Kings',
    auction_date: '2025-10-29T10:30:00Z',
    starting_bid: 625000,
    assessed_value: 780000,
    property_type: 'Condo',
    beds: 2,
    baths: 2,
    sqft: 1200,
    year_built: 2005,
    description: 'Luxury condo with stunning Manhattan views. Features floor-to-ceiling windows, gourmet kitchen, and in-unit washer/dryer. Building amenities include gym, rooftop terrace, and 24-hour doorman.',
    docket_number: '2025-345678',
    plaintiff: 'Chase Bank',
    status: 'upcoming',
    is_active: true,
    created_at: '2025-09-14T12:05:21.351Z',
    updated_at: '2025-09-14T12:05:21.351Z',
    neighborhood: 'Williamsburg',
    borough: 'Brooklyn',
    defendant: 'Robert Johnson'
  }
];

async function populateData() {
  try {
    console.log('Starting data population...');

    // Optional: Clear existing data
    const { error: deletePropError } = await supabase.from('properties').delete().neq('id', 'nonexistent');
    if (deletePropError) console.warn('Clear properties failed (may be empty):', deletePropError.message);
    const { error: deleteForeError } = await supabase.from('foreclosure_listings').delete().neq('id', 'nonexistent');
    if (deleteForeError) console.warn('Clear foreclosures failed (may be empty):', deleteForeError.message);

    // Insert properties
    const { data: props, error: propError } = await supabase.from('properties').insert(propertiesData);
    if (propError) throw propError;
    console.log(`Inserted ${props.length} properties.`);

    // Insert foreclosure listings
    const { data: fore, error: foreError } = await supabase.from('foreclosure_listings').insert(foreclosureData);
    if (foreError) throw foreError;
    console.log(`Inserted ${fore.length} foreclosure listings.`);

    console.log('Data population complete! Now run the updated `node test_supabase_connection.js` to verify counts, then restart server with `npm run start:supabase` and test /api/properties.');
  } catch (error) {
    console.error('Population failed:', error.message);
    if (error.code === '42P01') console.log('Tables do not exist. Run `npm run db:push` first to apply schema from shared/schema.ts.');
  }
}

populateData();